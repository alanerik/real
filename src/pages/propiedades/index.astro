---
// index.astro - Refactorizado
import Layout from '@/layouts/Layout.astro';
import ListadoPropiedades from '@/components/ListadoPropiedades/ListadoPropiedades.astro';
import Buscador from '@/components/Buscador.jsx';
import BuscarButton from '@/components/BuscarButton';
import Breadcrumbs from '@/components/Breadcrumbs.jsx';
import { getCollection } from 'astro:content';

// Importar utils para metadata y estadísticas
import { 
  generateMetadata,
  generateStructuredData
} from '@/utils/index.js';

// Obtener todas las propiedades para generar estadísticas
const allProperties = await getCollection('propiedades');

// Metadata específica para la página de todas las propiedades
const metadata = {
  title: `Propiedades en Venta y Alquiler - ${allProperties.length} disponibles`,
  description: `Explora nuestro catálogo completo con ${allProperties.length} propiedades en venta y alquiler. Encuentra tu propiedad ideal.`,
  keywords: 'propiedades, inmobiliaria, venta, alquiler, casas, departamentos, terrenos'
};

// Schema.org para la página de listado general
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": metadata.title,
  "description": metadata.description,
  "numberOfItems": allProperties.length,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": allProperties.length,
    "description": "Catálogo completo de propiedades"
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Inicio",
        "item": "/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Propiedades"
      }
    ]
  }
};
---

<Layout 
  title={metadata.title}
  description={metadata.description}
  keywords={metadata.keywords}
>
  <!-- Schema.org -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

  <Breadcrumbs pathname={Astro.url.pathname} client:load />
  
  <!-- Hero Section -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center">
      <h1 class="text-4xl font-bold text-gray-900 sm:text-5xl mb-12">
        Propiedades en Venta y Alquiler
      </h1>
      

    </div>
    
    <!-- Buscador -->
    <div class="max-w-4xl mx-auto">
      <Buscador 
        showCiudad={true} 
        showTipoVenta={true} 
        showTipoAlquiler={true} 
        showAmbientes={true} 
        layout="horizontal" 
        className="mb-6"
        client:load
      />
      
      <div class="flex items-center justify-center">
        <BuscarButton client:load/>
      </div>
    </div>
  </div>

  <!-- Listado de propiedades -->
  <ListadoPropiedades />
</Layout>