---
import AdminLayout from "../../layouts/AdminLayout.astro";
import Dashboard from "../../components/admin/Dashboard";
---

<AdminLayout title="Panel de Administración">
    <div class="min-h-screen bg-gray-100">
        <nav class="bg-white shadow-sm">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">
                            Panel de Administración
                        </h1>
                    </div>
                    <div class="flex items-center">
                        <button
                            id="logout-btn"
                            class="text-gray-500 hover:text-gray-700"
                            >Cerrar Sesión</button
                        >
                    </div>
                </div>
            </div>
        </nav>

        <main>
            <Dashboard client:only="react" />
        </main>
    </div>
</AdminLayout>

<script>
    import { supabase } from "../../lib/supabase";

    const logoutBtn = document.getElementById("logout-btn");

    // Check Auth
    const checkUser = async () => {
        const {
            data: { session },
        } = await supabase.auth.getSession();
        if (!session) {
            window.location.href = "/admin/login";
        }
    };

    checkUser();

    // Logout
    logoutBtn?.addEventListener("click", async () => {
        await supabase.auth.signOut();
        window.location.href = "/admin/login";
    });
</script>
