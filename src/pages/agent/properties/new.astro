---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import AgentPropertyForm from "../../../components/agent/AgentPropertyForm";
---

<AdminLayout title="Nueva Propiedad - Agente">
    <div class="min-h-screen py-10">
        <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <AgentPropertyForm client:only="react" />
        </main>
    </div>
</AdminLayout>

<script>
    import { supabase } from "../../../lib/supabase";
    import { getAgentByUserId } from "../../../lib/agents";

    const checkUser = async () => {
        const {
            data: { session },
        } = await supabase.auth.getSession();

        if (!session) {
            window.location.href = "/agent/login";
            return;
        }

        const agent = await getAgentByUserId(session.user.id);
        if (!agent) {
            await supabase.auth.signOut();
            window.location.href = "/agent/login";
        }
    };

    checkUser();
</script>
