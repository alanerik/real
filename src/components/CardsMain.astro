---
import CardMain from './CardMain.jsx';
import BuscarButton from './BuscarButton.jsx';
import { getCollection } from 'astro:content';

const allProperties = await getCollection('propiedades');
const properties = allProperties.slice(0, 4);

function formatPrice(price, currency) {
  return new Intl.NumberFormat('es-AR', {
    style: 'currency',
    currency: currency || 'USD'
  }).format(price);
}
---

<section class="py-12 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-8">Últimas Propiedades</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      {properties.map(property => (
        <CardMain 
          client:load
          image={property.data.image} 
          title={property.data.title} 
          description={property.data.description} 
          price={formatPrice(property.data.price, property.data.currency)}
          slug={property.slug}
        />
      ))}
    </div>
    <div class="text-center mt-8">
      <BuscarButton variant="header" client:load>Ver más</BuscarButton>
    </div>
  </div>
</section>
